{% extends "base.html" %}
{% block title %}Profile page{% endblock %}

{% block content %}

<div class="row head-bg">
    <div class="col s12 l8 offset-l2">
        <h1 class="center-align">My Profile</h1>
        <hr class="breakline">
    </div>
</div>
<!-- Flash messages -->
<div class="row flashes">
    <div class="col s12 center-align">
        {% with messages = get_flashed_messages() %}
        {% for message in messages %}
        <p>{{ message }}</p>
        {% endfor %}
        {% endwith %}
    </div>
</div>
<div class="row">
    <div class="col 12 s12 l8 offset-l2">
        <h2>Personal information</h2>

        <!-- Personal information-->
        <div class="row valign-wrapper">
            <div class="col s3">
                <img src={{user.user_imgUrl}} alt="" class="circle responsive-img profile-img">
            </div>
            <div class="col s9 ">
                <h3 class="profile-name"><i class="fas fa-user profile-icon"></i>{{ user.first_name }}
                    {{user.last_name}}</h3>
                <p><i class="fas fa-map-marker-alt profile-icon"></i> {{ user.city}}, {{user.country}}</p>
            </div>
        </div>
        <button id="edit-personal-info" data-target="personal-info-modal"
            class="btn modal-trigger btn-send">Edit</button>
        <hr class="margin-top">

        <!-- Account settings -->
        <h2>Account settings</h2>
        <p id="user_email"><i class="fas fa-envelope profile-icon"></i> {{ user.email}}</p>
        <p><i class="fas fa-unlock-alt profile-icon"></i> ************</p>
        <button id="edit-email" data-target="email-modal" class="btn modal-trigger btn-send">Edit email</button>
        <button class="btn modal-trigger btn-send" data-target="password-modal" id="edit-password">Edit
            password</button>
        <hr class="margin-top">

        <!-- Preferences -->
        <h2>My preferences</h2>
        <form id="form-edit-preferences" method="post" method="POST"
            action="{{ url_for('edit_preferences', user_id=user._id) }}">
            <div class="row">
                <div class="col s12">
                    <div class="row">
                        <div class="col s12">
                            <h3>As an attendee</h3>
                        </div>
                        <div class="col m9 s7" for="event_reminder">Event reminder</div>
                        <div class="col m3 s5 switch">
                            <label for="event_reminder">
                                Off
                                <input type="checkbox" id="event_reminder"
                                    value="{{ user.preferences['event_reminder'] }}" name="event_reminder">
                                <span class="lever"></span>
                                On
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col m9 s7" for="event_update">Events postponed / cancelled</div>
                        <div class="col m3 s5 switch">
                            <label for="event_update">
                                Off
                                <input type="checkbox" id="event_update" value="{{ user.preferences['event_update'] }}"
                                    name="event_update">
                                <span class="lever"></span>
                                On
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col m9 s7" for="query_answered">Answer to my questions</div>
                        <div class="col m3 s5 switch">
                            <label for="query_answered">
                                Off
                                <input type="checkbox" id="query_answered"
                                    value="{{ user.preferences['query_answered'] }}" name="query_answered">
                                <span class="lever"></span>
                                On
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s12">
                            <h3>As an organiser</h3>
                        </div>
                        <div class="col m9 s7" for="new_participant">New participants to my events</div>
                        <div class="col m3 s5 switch">
                            <label for="new_participant">
                                Off
                                <input type="checkbox" id="new_participant"
                                    value="{{ user.preferences['new_participant'] }}" name="new_participant">
                                <span class="lever"></span>
                                On
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col m9 s7" for="event_question">Questions to my events</div>
                        <div class="col m3 s5 switch">
                            <label for="event_question">
                                Off
                                <input type="checkbox" id="event_question"
                                    value="{{ user.preferences['event_question'] }}" name="event_question">
                                <span class="lever"></span>
                                On
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col m9 s7" for="new_follower">New followers to my groups</div>
                        <div class="col m3 s5 switch">
                            <label for="new_follower">
                                Off
                                <input type="checkbox" id="new_follower" value="{{ user.preferences['new_follower'] }}"
                                    name="new_follower">
                                <span class="lever"></span>
                                On
                            </label>
                        </div>
                    </div>

                </div>
            </div>
            <button class="btn btn-send" id="save-preferences">Save preferences</button>
        </form>
        <!-- Delete profile -->

        <hr class="margin-top">
        <h2>Additional actions</h2>
        <button class="btn modal-trigger btn-send" data-target="delete-modal" type="submit" id="delete-profile">Delete
            account</button>
    </div>
</div>


<!-- Modal personal information -->
<div id="personal-info-modal" class="modal">
    <div class="modal-content">
        <!--Modal content -->
        <i class="far fa-times-circle close-form modal-close" data-group="close-modal"
            data-target="personal-info-modal"></i>
        <h2 class="center-align">Edit personal information</h2>
        <hr class="breakline">

        <!-- form-->
        <form id="form-edit-info" class="modal-forms" method="post"
            action="{{ url_for('edit_info', user_id=user._id) }}">
            <!-- Image Url-->
            <div class="row">
                <div class="col s12 m2 center-align">
                    <img src={{user.user_imgUrl}} alt="" class="circle responsive-img profile-img resize">
                </div>
                <div class="input-field col s12 m10">
                    <input id="user-img" name="user-img" value="{{ user.user_imgUrl }}" type="text" class="validate"
                        minlenght="1">
                    <label for="user-img">Image URL</label>
                </div>
            </div>
            <!-- First name -->
            <div class="row">
                <div class="input-field col s12">
                    <input id="fname" name="fname" value="{{ user.first_name }}" type="text" class="validate"
                        minlenght="1" maxlength="32" pattern="^[a-zA-Z._-]{1,32}$" required>
                    <label for="fname">First name</label>
                    <p class="error-text hide" for="fname"></p>
                </div>
            </div>
            <!-- Last name -->
            <div class="row">
                <div class="input-field col s12">
                    <input id="lname" name="lname" value="{{ user.last_name }}" type="text" class="validate"
                        minlenght="1" maxlength="32" pattern="^[a-zA-Z._-]{1,32}$" required>
                    <label for="lname">Last name</label>
                    <p class="error-text hide" for="lname"></p>
                </div>
            </div>
            <!-- City -->
            <div class="row">
                <div class="input-field col s12">
                    <input id="city" name="city" value="{{ user.city }}" type="text" class="validate" minlenght="1"
                        maxlength="32" pattern="^[a-zA-Z._-]{1,32}$" required>
                    <label for="city">City</label>
                    <p class="error-text hide" for="city"></p>
                </div>
            </div>
            <!-- Country -->
            <div class="row">
                <div class="input-field col s12">
                    <input id="country" name="country" value="{{ user.country }}" type="text" class="validate"
                        minlenght="1" maxlength="32" pattern="^[a-zA-Z._- ]{1,32}$" required>
                    <label for="country">Country</label>
                    <p class="error-text hide" for="country"></p>
                </div>
            </div>
            <!-- Buttons -->
            <div class="row">
                <div class="col s12 center-align margin-top">
                    <button class="btn btn-send " type="submit" name="submit">Submit</button>
                    <button class="btn btn-send modal-close" type="button">Close</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Modal edit email  -->
<div id="email-modal" class="modal">
    <div class="modal-content">
        <!--Modal content -->
        <i class="far fa-times-circle close-form modal-close" data-group="close-modal" data-target="email-modal"></i>
        <h2 class="center-align">Change your email</h2>
        <hr class="breakline">
        <!-- form -->
        <form id="form-edit-email" class="modal-forms" method="post" method="POST"
            action="{{ url_for('edit_email', user_id=user._id) }}">
            <div class="row">
                <div class="input-field col s12">
                    <input id="current-email" type="email" name="current-email" value="{{ user.email }}" maxlength="50"
                        class="validate" disabled>
                    <label for="current-email">current-email</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">
                    <input id="email" type="email" name="email" maxlength="50" class="validate" required>
                    <label for="email">New email</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">
                    <input id="confirm-email" type="email" name="confirm-email" data-target="email" data-check="check"
                        maxlength="50" class="validate" required>
                    <label for="confirm-email">Confirm your new email</label>
                    <p class="error-text hide" for="confirm-email"></p>
                </div>
            </div>
            <!-- Buttons -->
            <div class="row">
                <div class="col s12 center-align margin-top">
                    <button class="btn btn-send modal-close" type="submit" name="submit">Submit</button>
                    <button class="btn btn-send modal-close" type="button">Close</button>
                </div>
            </div>
        </form>

    </div>
</div>

<!-- Modal edit password  -->
<div id="password-modal" class="modal">
    <div class="modal-content">
        <!--Modal content -->
        <i class="far fa-times-circle close-form modal-close" data-group="close-modal" data-target="password-modal"></i>
        <h2 class="center-align">Change your password</h2>
        <hr class="breakline">

        <!-- Error messages-->
        <p id="message-error" class="center-align flashes hide"></p>

        <!-- form-->
        <form id="form-edit-password" class="modal-forms" method="post" method="POST"
            action="{{ url_for('edit_password', user_id=user._id) }}">
            <div class="row">
                <div class="input-field col s12">
                    <!-- https://regex101.com/ -->
                    <i class="password-visible far fa-eye" data-target="current-pwd"></i>
                    <input id="current-pwd" type="password" name="current-pwd" minlenght="8" maxlength="32"
                        pattern="^(?=.*[0-9])(?=.*[A-Z])(?=.*[a-z])(?=.*[!@\-?~$%*^()~+=._])(?=\S+$).{8,32}$"
                        class="validate" required>
                    <label for="current-pwd">Current password</label>
                    <p class="error-text hide" for="current-pwd"></p>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">
                    <!-- https://regex101.com/ -->
                    <i class="password-visible far fa-eye" data-target="password"></i>
                    <input id="password" type="password" name="password" minlenght="8" maxlength="32"
                        pattern="^(?=.*[0-9])(?=.*[A-Z])(?=.*[a-z])(?=.*[!@\-?~$%*^()~+=._])(?=\S+$).{8,32}$"
                        class="validate" required>
                    <label for="password">New Password</label>
                    <p class="helper-text">Eight or more characters with a mix of letters, numbers and symbols.</p>
                    <p class="error-text hide" for="password"></p>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">
                    <i class="password-visible far fa-eye" data-target="conf-new-pwd"></i>
                    <input id="conf-new-pwd" type="password" name="conf-new-pwd" data-target="password"
                        data-check="check" minlenght="8" maxlength="32"
                        pattern="^(?=.*[0-9])(?=.*[A-Z])(?=.*[a-z])(?=.*[!@\-?~$%*^()~+=._])(?=\S+$).{8,32}$"
                        class="validate" required>
                    <label for="conf-new-pwd">Confirm new password</label>
                    <p class="error-text hide" for="conf-new-pwd"></p>
                </div>
            </div>
            <!-- Buttons -->
            <div class="row">
                <div class="col s12 center-align margin-top">
                    <button class="btn btn-send" type="submit" name="submit">Submit</button>
                    <button class="btn btn-send modal-close" type="button">Close</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Delete profiel  -->
<div id="delete-modal" class="modal">
    <div class="modal-content">
        <!--Modal content -->
        <i class="far fa-times-circle close-form modal-close" data-group="close-modal" data-target="password-modal"></i>
        <h2 class="center-align">Delete account</h2>
        <hr class="breakline">
        <p>Are you sure you want to delete your profile?
            All your events and groups for which you are sole admin will be deleted.
        </p>
        <!-- Buttons -->
        <div class="row">
            <div class="col s12 center-align margin-top">
                <a href="{{ url_for('delete_account', user_id=user._id) }}"" class=" btn btn-send modal-close"
                    type="submit" name="submit">Delete</a>
                <button class="btn btn-send modal-close" type="button">Cancel</button>
            </div>
        </div>

    </div>
</div>
{% endblock %}